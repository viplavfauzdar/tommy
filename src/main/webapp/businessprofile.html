<!DOCTYPE html>
<html>
    <head>
        <title>Finance Georgia | Business Profile</title>
        <meta charset='utf-8'>
        <meta content='Description' name='description'>
        <meta content='1 day' name='revisit-after'>
        <meta content='width=device-width, initial-scale=1' name='viewport'>
        <link href="stylesheets/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
        <link href='//fonts.googleapis.com/css?family=Lato:100,300,400,300italic,400italic,700,700italic,900' rel='stylesheet'>
        <link href='//fonts.googleapis.com/css?family=Raleway:400,600,700' rel='stylesheet'>
        <link href="stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
        <style>
            a:link  {
                text-decoration: none;
            }
        </style>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    </head>
    <body>

        <div class='wrapper'>

            <!-- Topbar -->            
            <div class='top' data-spy='affix' id='navbar'></div>

            <section class='jumbotronsmall' id='home'>
                <div class='flexslider' id='flexslider1'>
                    <ul class='slides'>

                        <li class='slide light'>
                            <img alt='' class='fs fo' src='Assets/Slider/header-04.jpg'>

                        </li>
                    </ul>
                </div>
            </section>            

            <!-- Business Profile -->

            <section class='grey' id='team'>
                <div class='row-fluid'>
                    <div class='col-md-12 text-left padding-20'>
                        <h2 id='businessName' style="text-transform: capitalize"></h2>
                        <!--                        <h4>Slogan or quick overview of company</h4>-->
                        <!--                        <p id='summary1'></p>-->
                        <h4 id='address'></h4>
                    </div>
                    <div class='col-md-8 col-xs-8'>
                        <div class='member'>
                            <div class='img'>
                                <div class='social'>
                                    <div class='icons'>
                                        <img src="Assets/Finance-Georgia-Logo.png" alt=""/>
                                    </div>
                                </div>
                                <!-- company slide show  - class fo is what dims the image. don't need it here -->
                                <section class='jumbotron minfixed' id="busSlides">
                                    <div class='flexslider' id='flexslider2'>
                                        <ul class='slides'>
                                            <li class='slide dark'>
                                                <img style='width:663px;height:400px' id='businessPic1'>
                                            </li>
                                            <li class='slide dark'>
                                                <img style='width:663px;height:400px' id='businessPic2'>
                                            </li>
                                        </ul>
                                    </div>
                                </section>
                            </div>

                            <script>
                                //This seems to work  - NOT SURE IF THIS IS NEEDDED.
                                // this was prolly because of extra li the flex slider inserts if the jq at the bottom is used
                                //potential sol to move getJSON to the top
                                var hash = window.location.hash;
                                var busId = hash.substring(hash.indexOf('/') + 1, hash.length);
                                var busIdd = busId.substring(0, busId.indexOf('#'));
                                console.log("Bus ID: " + busIdd);
                                var uid = busId.substring(busId.indexOf('#') + 1, busId.length);
                                console.log("User ID: " + uid);
                                document.getElementById("businessPic1").src = "/Uploader?action=stream&folder=" + uid + "&filename=businessPic1.jpg&t=" + Math.random();
                                document.getElementById("businessPic2").src = "/Uploader?action=stream&folder=" + uid + "&filename=businessPic2.jpg&t=" + Math.random();
                            </script>

                        </div>
                        <h2>Company Details</h2>
                        <h4>Company Summary</h4>
                        <p id='summary'></p>
                        <h4>Description</h4>
                        <p id='description'></p>

                        <!-- 16:9 aspect ratio -->
                        <div class="embed-responsive embed-responsive-16by9">
                            <iframe class="embed-responsive-item" src="" id="businessVideo"></iframe>
                        </div>
                    </div>
                    <div class='col-md-4 col-xs-6'>
                        <div class='member'>
                            <div class='img'>
                                <div class='social'>
                                    <div class='icons'>
                                        <img src="Assets/Finance-Georgia-Logo.png" alt=""/>
                                    </div>

                                </div>
                                <img style='width:320px;height:250px' id="businessLogo1">
                            </div>
                            <div class='info'>
                                <h4 id='businessName1'></h4>
                                <h5 id='address1'></h5>
                                <h6><span class="target">TARGET: <b id='targetAmount'></b></span><span class="pledged"> PLEDGED: <b id='amountInvested'></b></span></h6>
                                <div class='progress'>
                                    <div aria-valuemax='100' aria-valuemin='0'  class='progress-bar progress-bar-success' role='progressbar'> <!-- aria-valuenow='50' cause to default to 50%-->
                                        <span class='sr-only'>
                                            
                                        </span>
                                    </div>
                                </div>
                                <p id='summary1'></p>
                                <a class='btn btn-default invest' id="ivstComp" href='#about' style="width: 250px" data-fa-invest-now="">Invest in this company</a>
                                <button class='btn btn-default opennew' id="execSumm" style="width: 250px">Executive Summary</button>
                                <button class='btn btn-default' id="businessPlan" style="width: 250px">Business Plan</button>
                                <button class='btn btn-default' id="financials" style="width: 250px">Financials</button>
                                <a class='icon fa fa-globe' id='lnkWs' target='_blank' href='#'></a>
                                <a class='icon fa fa-facebook-square' id='lnkFb' target='_blank' href='#'></a>
                                <a class='icon fa fa-twitter-square' id='lnkTw' target='_blank' href='#'></a>
                                <a class='icon fa fa-google-plus-square' id='lnkGp' target='_blank' href='#'></a>
                                <a class='icon fa fa-linkedin-square' id='lnkLk' target='_blank' href='#'></a>
                            </div>
                        </div>
                    </div>


                </div>

            </section>

            <!-- Banner -->
            <div id='banner'></div>

            <!-- Footer -->
            <div id='footer'></div>

            <!-- Copyright -->
            <div id='copyright'></div>

        </div>
        <!-- jQuery -->    
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <!-- JQuery validation -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.13.1/jquery.validate.min.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.13.1/additional-methods.min.js'></script>
        <!-- Easing -->
        <script src="javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
        <!-- Flexslider -->
        <script src="javascripts/jquery.flexslider.js" type="text/javascript"></script>
        <!-- Bootstrap JS -->
        <script src="javascripts/bootstrap.min.js" type="text/javascript"></script>
        <!--         Waypoints -->
        <script src="javascripts/waypoints.min.js" type="text/javascript"></script>
        <!--         Contactform 
                <script src="javascripts/validation.js" type="text/javascript"></script>        -->
        <!-- Functions -->
        <script src="javascripts/functions.js" type="text/javascript"></script>
        <!-- Autonumeric -->
        <script src="javascripts/autoNumeric.js" type="text/javascript"></script> 
        <!-- JQuery.Number -->
        <script src="javascripts/jquery.number.min.js" type="text/javascript"></script>
        <!-- FG -->
        <script src="javascripts/FG.js" type="text/javascript"></script>

        <script>

                                //** incase of missing pics or pics that didn't load
                                $("img").error(function () {
                                    $(this).unbind("error").attr("src", "img/placeholder.jpg");
                                });

                                $("a").error(function () {
                                    $(this).unbind("error").attr("href", "img/placeholder.jpg");
                                });



                                loaderOn();
                                $.getJSON("/rs/public/business/" + busId, function (item) {
                                    loaderOff();
                                    console.log(item.userId);
                                    //console.log(JSON.stringify(item));
                                    $('#address').html(item.address + ', ' + item.city + ', ' + item.state + ', ' + item.zip);
                                    $('#address1').html(item.address + ', ' + item.city + ', ' + item.state + ', ' + item.zip);
                                    $('#businessName').html(item.businessName);
                                    $('#businessName1').html(item.businessName);
                                    $('#summary').html(item.summary.replace(/(?:\r\n|\r|\n)/g, '<br />'));
                                    $('#summary1').html(item.summary.replace(/(?:\r\n|\r|\n)/g, '<br />'));
                                    $('#description').html(item.description.replace(/(?:\r\n|\r|\n)/g, '<br />'));
                                    $('#targetAmount').autoNumeric('init', {aSign: '$', mDec: 0});
                                    $('#targetAmount').autoNumeric('set', item.targetAmount);
                                    $('#amountInvested').autoNumeric('init', {aSign: '$', mDec: 0});
                                    $('#amountInvested').autoNumeric('set', item.amountInvested);
                                    $('.progress-bar').css('width', (100 * item.amountInvested / item.targetAmount) + '%');

                                    //if(uid === null || uid === '') 
                                    uid = item.userId;

                                    //set all images & documents
                                    //$('#businessLogo').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessLogo.jpg&t=" + Math.random());
                                    $('#businessLogo1').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessLogo.jpg&t=" + Math.random());
                                    $('#businessPic1').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessPic1.jpg&t=" + Math.random());
                                    $('#businessPic2').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessPic2.jpg&t=" + Math.random());
                                    //$('#execSumm').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=execSumm.pdf&t=" + Math.random());
                                    //$('#businessPlan').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=businessPlan.pdf&t=" + Math.random());
                                    //$('#financials').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=financials.pdf&t=" + Math.random());

                                    //below doesn't work either - doesn't even load images
//                slider = "<div class='flexslider' id='flexslider2'>" + 
//                    "<ul class='slides'>" +
//                        "<li class='slide dark'>"
//                            "<img style='width:663px;height:400px' class='fo' id='businessPic1' src='/Uploader?action=stream&folder=" + uid + "&filename=businessPic1.jpg'>" +
//                        "</li>" +
//                        "<li class='slide dark'>" +
//                            "<img style='width:663px;height:400px' class='fo' id='businessPic2' src='/Uploader?action=stream&folder=" + uid + "&filename=businessPic2.jpg'>" +
//                        "</li>" +
//                    "</ul>" +
//                "</div>";
                                    //$('#busSlides').append(slider);

                                    //web & social
                                    console.log(item.fb);
                                    if (item.ws !== null && item.ws !== '')
                                        $('#lnkWs').attr('href', item.ws);
                                    else
                                        $('#lnkWs').hide();
                                    if (item.fb !== null && item.fb !== '')
                                        $('#lnkFb').attr('href', item.fb);
                                    else
                                        $('#lnkFb').hide();
                                    if (item.tw !== null && item.tw !== '')
                                        $('#lnkTw').attr('href', item.tw);
                                    else
                                        $('#lnkTw').hide();
                                    if (item.gp !== null && item.gp !== '')
                                        $('#lnkGp').attr('href', item.gp);
                                    else
                                        $('#lnkGp').hide();
                                    if (item.lk !== null && item.lk !== '')
                                        $('#lnkLk').attr('href', item.lk);
                                    else
                                        $('#lnkLk').hide();

                                    //causing errors in chrome something cast_sender.js
                                    console.log(item.videoUrl);
                                    var vidurl = item.videoUrl;
                                    if (vidurl != null)
                                        $('#businessVideo').attr("src", vidurl.replace("http://", "https://"));// "/Uploader?action=stream&folder=" + uid + "&filename=financials.pdf");

                                    //console.log($('#businessLogo').css('height'));
                                });

                                //Invest button functionality - below not needed. at least not for now as we are doing a manual approval process
//                                var prt = false, chk = false;
//                                 $.get('/Uploader?action=check&folder=' + localStorage.getItem('userId') + '&filename=partialriskdisclosure.pdf', function(res){                                            
//                                    prt = res;//.toString();                                             
//                                });
//                                $.get('/Uploader?action=check&folder=' + localStorage.getItem('userId') + '&filename=checklist_accinvestor.pdf', function(res){
//                                   chk = res;//.toString();                                            
//                                });     
                                var usrObj = JSON.parse(localStorage.getItem('usrObj'));  
                                $('#ivstComp').click(function (e) {
                                    e.preventDefault();                                                                        
                                    if (!isUsrLoggedIn || localStorage.getItem('userType') == 'B' || localStorage.getItem('userType') == 'N') {
                                        fgDialogBS('<h4>You need to be logged in as an investor to perform this action!</h4>');
                                    } else {
                                        //window.location='invest.html' + '#' + busIdd;
                                        //below is temp till fundamerica crap is in place and the check for approved flag
                                        //if(prt==='true' || chk==='true'){
                                        //    console.log(prt);
                                        //    console.log(chk);
                                        //}else{                                                                              
                                        if(usrObj!==null && usrObj.approved!==1){
                                            fgDialogBS('<h4>A Finance Georgia team member must first approve your completed investor profile, before  you can invest in a company. If you have signed the required legal documents and filled in all information, you can expect to be approved within 24 hours.</h4>');
                                        }else{
                                            window.location='invest.html' + '#' + busIdd;
                                        }
                                    }
                                });
                                                                
                                //fundamerica stuff. not needed.
                                //populate fundamerica stuff only if logged in investor - DISABLED FOR NOW
//                                if(usrObj!=null && usrObj.approved==1){//prt==='true' || chk==='true'){
//                                    if (isUsrLoggedIn && localStorage.getItem('userType') == 'U' || localStorage.getItem('userType') == 'A' || localStorage.getItem('userType') == 'V'){                                          
////                                        $.getJSON('/rs/investnowbutton/' + busIdd, function (data) {
////                                            console.log(JSON.stringify(data));
////                                            $('head').append(data.script);
////                                            $('#ivstComp').attr("data-fa-invest-now", data.btnAttr);
////                                            //$('#ivstComp').trigger('click');
////                                        });
//                                    }
//                                }
                                                                
                                //document buttons
                                $('#execSumm').click(function(){
                                    if(usrObj==null){ 
                                        fgDialogBS('You need to sign up to view business documents. Please use the link in the menu to sign up');
                                        return;
                                    }
                                    window.open("/Uploader?action=stream&folder=" + uid + "&filename=execSumm.pdf&t=" + Math.random());
                                });
                                $('#businessPlan').click(function(){
                                    if(usrObj==null){ 
                                        fgDialogBS('You need to sign up to view business documents. Please use the link in the menu to sign up');
                                        return;
                                    }
                                    window.open("/Uploader?action=stream&folder=" + uid + "&filename=businessPlan.pdf&t=" + Math.random());
                                });
                                $('#financials').click(function(){
                                    if(usrObj==null){ 
                                        fgDialogBS('You need to sign up to view business documents. Please use the link in the menu to sign up');
                                        return;
                                    }
                                    window.open("/Uploader?action=stream&folder=" + uid + "&filename=financials.pdf&t=" + Math.random());
                                });
                                
                                



//            uid = 143;
//            lid = 39;
//            bid = 22;
//            var user, loc, business;
//
//            $.getJSON("/rs/user/" + uid, function (data) {
//                user = data;
//                //alert(user.firstName);
//                console.log(user);
//            });
//            $.getJSON("/rs/location/" + lid, function (data) {
//                loc = data;
//                //alert(location.address);
//                console.log(loc);
//                $('#address').html(loc.address + ', ' + loc.city + ', ' + loc.state + ', ' + loc.zip);
//                $('#address1').html(loc.address + ', ' + loc.city + ', ' + loc.state + ', ' + loc.zip);
//            });
//            $.getJSON("/rs/business/" + bid, function (data) {
//                business = data;
//                //alert(business.businessName);
//                console.log(business);
//                $('#businessName').html(business.businessName);
//                $('#businessName1').html(business.businessName);
//                $('#summary').html(business.summary.replace(/(?:\r\n|\r|\n)/g, '<br />'));
//                $('#summary1').html(business.summary.replace(/(?:\r\n|\r|\n)/g, '<br />'));
//                $('#description').html(business.description.replace(/(?:\r\n|\r|\n)/g, '<br />'));
//                $('#targetAmount').autoNumeric('init', {aSign: '$'});
//                $('#targetAmount').autoNumeric('set', business.targetAmount);
//                //$('#targetAmount').html(business.targetAmount);
//            });
//
//            //set all images
//            $('#businessLogo').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessLogo.jpg");
//            $('#businessLogo1').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessLogo.jpg");
//            $('#businessPic1').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessPic1.jpg");
//            $('#businessPic2').attr("src", "/Uploader?action=stream&folder=" + uid + "&filename=businessPic2.jpg");
//            $('#execSumm').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=execSumm.pdf");
//            $('#businessPlan').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=businessPlan.pdf");
//            $('#financials').attr("href", "/Uploader?action=stream&folder=" + uid + "&filename=financials.pdf");
//
//            //causing errors in chrome something cast_sender.js
//            $('#businessVideo').attr("src", "//www.youtube.com/embed/zpOULjyy-n8?rel=0");// "/Uploader?action=stream&folder=" + uid + "&filename=financials.pdf");

                                //tried to open new tabs for links
                                //below doesn't work. opens a new tab but also sends the parent to the link
                                //$('.opennew').click(function(e){
                                //    e.preventDefault();
                                //alert($('.opennew').attr('href'));
                                //var url=$('.opennew').attr('href');
                                // return window.open(url);
                                //$('.opennew').attr('href','#');
                                //return false;
                                //});


        </script>
    </body>
</html>
